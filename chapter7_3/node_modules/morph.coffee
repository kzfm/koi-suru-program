exec = require('child_process').exec
http = require('http')
querystring = require('querystring')
parser = require('libxml-to-js')
util = require('util')

exports.Morph = class Morph
  analyze: (text, callback) ->
    qst = querystring.stringify({
      appid: 'TtFZaE2xg65B6HxLhcVnXjOMz58YEni8.5lRxVQQUXDx9gSYr4SH8IhE.uw-',
      sentence: text,
      results: 'ma',
      filter: 9
    })

    options = {
      host: 'jlp.yahooapis.jp',
      port: 80,
      path: '/MAService/V1/parse?' + qst
    };

    http.get(options, (res) ->
        body = ""
        res.on 'data', (data) -> body += data; return
        res.on 'end', ->
          parser body, (err, result) ->
            callback(err, result.ma_result.word_list)
            return
          return
     ).on 'error', (e) ->
       console.log("Got error: " + e.message)
       return
     return

