responder = require('responder')
Dictionary = require('dictionary').Dictionary
Emotion = require('emotion').Emotion

exports.Unmo = class Unmo
  constructor: (@name) ->
    @dictionary = new Dictionary()
    @emotion = new Emotion(@dictionary)

    @resp_random = new responder.RandomResponder('Random',@dictionary)
    @resp_what = new responder.WhatResponder('What')
    @resp_pattern = new responder.PatternResponder('Pattern',@dictionary)
    @responder = @resp_pattern

  responder_name: () -> @responder.name
  mood: () -> @emotion.mood

  dialogue: (input) ->
    @emotion.update(input)

    rand = Math.floor(Math.random() * 100)
    if rand >= 0 and rand < 60
      @responder = @resp_pattern
    else if rand < 90
      @responder = @resp_random
    else
      @resp_random = @resp_what
    resp = @responder.response(input, @emotion.mood)
    @dictionary.study(input)
    if input is 'save'
      @dictionary.save()
    else
      resp

  save: ->
    @dictionary.save()
