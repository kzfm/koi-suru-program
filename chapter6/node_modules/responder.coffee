select_random = (l) -> l[Math.floor(Math.random()*l.length)]

class Responder
 constructor: (@name, @dictionary) ->
 response: (input) -> ''

exports.WhatResponder = class extends Responder
  response: (input) -> input + "ってなに？"

exports.RandomResponder = class extends Responder
  constructor: (@name, @dictionary) ->
    super @name, @dictionary
  response: (input) -> select_random(@dictionary.random)

exports.PatternResponder = class extends Responder
  constructor: (@name, @dictionary) ->
    super @name, @dictionary

  response: (input, mood) ->
    for ptn in @dictionary.pattern
      m = ptn.pmatch(input)
      if m?
        resp = ptn.choice(mood)
        if resp isnt null
          res = resp.replace(/ptn['pattern']/, m[0])
          break
    res ?= select_random(@dictionary.random)

